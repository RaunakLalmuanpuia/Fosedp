import{Q as he,a as de}from"./QBreadcrumbs-f1fcde01.js";import{a1 as ce,h as _,v as we,T as ae,o as f,c as v,w as o,a as r,t as Z,u as k,b as J,d as l,Q as $,C as W,l as Ve,e as K,f as b,aI as xe,m as pe,g as Ce,r as ee,av as te,q as E,F as ue,au as qe,aw as V,p as le,s as x,x as C,y as A,k as S,n as Se,aH as Qe,ax as Fe}from"./app-a7abb58d.js";import{Q as T}from"./QSelect-57ce204b.js";import{Q as me}from"./QForm-ea84dcf4.js";import{Q as I}from"./QChip-85d4182d.js";import{Q as Ae}from"./QTable-33cc80a5.js";import{_ as Ue,a as $e,b as Be,c as De}from"./DCApprovalForward-6efa863d.js";import"./rtl-36dd996b.js";import"./use-fullscreen-7c8ce305.js";const Pe={class:"flex justify-between items-center q-pl-md"},Ne={class:"text-lg q-ma-none q-my-sm"},Re={class:"q-pl-md"},Oe={class:"text-color text-weight-medium q-ma-none"},Ee={key:0,class:"text-negative q-ma-none"},Ie=r("div",{class:"q-mx-md q-my-sm text-weight-medium text-color"},"Select your recipient",-1),Te={class:"q-gutter-sm"},Ye={class:"flex q-gutter-sm q-mt-md"},je={__name:"BulkForward",props:["files"],emits:["onSuccess"],setup(g,{emit:y}){const X=g,i=ce(),Y=_([]),B=_(!1),D=_(null),c=we({user:null,remark:""}),p=ae(()=>{var h;return(h=D.value)==null?void 0:h.toUpperCase()}),P=h=>{let t=null;switch(h.toLowerCase()){case"dc":t=route("option.dc-users");break;case"planning":case"admin":t=route("option.planning-users");break;case"department":t=route("option.department-users");break;case"executive":t=route("option.executive-users");break;case"office":t=route("option.associated-users");break}c.user=null,i.loading.show({message:"Fetching Users"}),axios.get(t).then(d=>{const{message:q,list:w}=d.data;Y.value=w}).catch(d=>{var q,w;i.notify({type:"negative",message:((w=(q=d.response)==null?void 0:q.data)==null?void 0:w.message)||d.toString()})}).finally(()=>i.loading.hide())},m=h=>{const t=X.files.map(d=>d.id)||[];c.transform(d=>({ids:t,user_id:d.user.value})).post(route("application.forward"),{onStart:d=>i.loading.show({message:"Forwarding..."}),onSuccess:d=>{y("onSuccess"),B.value=!1},onFinish:d=>i.loading.hide()})};return(h,t)=>(f(),v(Ce,{style:{width:"540px"},flat:"",class:""},{default:o(()=>{var d,q,w,j,L;return[r("div",Pe,[r("p",Ne,"FORWARD TO "+Z(k(p)),1),J(l($,{round:"",icon:"close",flat:"",class:"q-pa-xs"},null,512),[[W]])]),l(Ve,{class:"full-width"}),r("div",Re,[r("p",Oe,Z("No of Application to be Sent : "+((d=g.files)==null?void 0:d.length)||0),1),(w=(q=k(c))==null?void 0:q.errors)!=null&&w.ids?(f(),K("p",Ee,Z((L=(j=k(c))==null?void 0:j.errors)==null?void 0:L.ids),1)):b("",!0)]),Ie,r("div",Te,[l(xe,{modelValue:D.value,"onUpdate:modelValue":[t[0]||(t[0]=U=>D.value=U),P],options:[{value:"dc",label:"DC"},{value:"planning",label:"Planning"},{value:"executive",label:"Executive Board"},{value:"department",label:"Directorate"},{value:"office",label:"District Office"}],color:"primary",inline:""},null,8,["modelValue"])]),l(me,{class:"q-pa-md",onSubmit:m},{default:o(()=>{var U,G,H,M;return[l(T,{modelValue:k(c).user,"onUpdate:modelValue":t[1]||(t[1]=Q=>k(c).user=Q),outlined:"",options:Y.value,error:!!((G=(U=k(c))==null?void 0:U.errors)!=null&&G.user_id),"error-message":(M=(H=k(c))==null?void 0:H.errors)==null?void 0:M.user_id,rules:[Q=>!!Q||"Please select recipient"],label:"Select Recipient user"},null,8,["modelValue","options","error","error-message","rules"]),l(pe,{modelValue:k(c).remark,"onUpdate:modelValue":t[2]||(t[2]=Q=>k(c).remark=Q),type:"textarea",outlined:"",label:"Remark"},null,8,["modelValue"]),r("div",Ye,[J(l($,{type:"submit",color:"primary",label:"Confirm"},null,512),[[W]]),J(l($,{outline:"",color:"negative",label:"Cancel"},null,512),[[W]])])]}),_:1})]}),_:1}))}},Le={class:"flex justify-between items-center"},Ge=r("p",{class:"page-header"},"Inbox",-1),He=r("br",null,null,-1),Me={class:"flex justify-between items-center"},ze={class:"flex q-gutter-sm"},Je=["href"],We=r("p",{class:"text-color text-lg q-my-sm"},"Filter",-1),Ke={class:"flex q-gutter-sm q-mt-md"},Xe={key:0,class:"flex items-baseline q-gutter-sm q-mt-md"},Ze=r("p",{class:"text-bold text-primary"},"Filter :",-1),et=r("br",null,null,-1),tt={align:"right"},lt={class:"flex justify-end q-gutter-sm"},at={align:"right"},nt={class:"flex justify-end q-gutter-sm"},ft={__name:"Index",props:["search","list","departments","districts","filter","canVerify","canApprove","canPlanningVerify","canPlanningApprove","canExecutiveApprove","canBoardApprove"],setup(g){var ne,oe,se,ie;const y=g,X=[{name:"sn",align:"left",label:"SN",field:"id"},{name:"head_of_family",align:"left",label:"Head of Family",field:"head_of_family"},{name:"mobile",align:"left",label:"Mobile",field:"mobile"},{name:"epic_no",align:"left",label:"Epic no",field:"epic_no"},{name:"district",align:"left",label:"District",field:"district",format:n=>n==null?void 0:n.name},{name:"constituency",align:"left",label:"Constituency",field:"constituency",format:n=>n==null?void 0:n.name},{name:"department",align:"left",label:"Department",field:"department",format:n=>n==null?void 0:n.name},{name:"trade",align:"left",label:"Trade",field:"trade",format:n=>n==null?void 0:n.name},{name:"current_status",align:"center",label:"Status",field:"current_status"},{name:"action",label:"Action",field:"id"}],i=ce(),Y=_(y.list.data||[]),B=_(!1),D=_(!1),c=_({page:y.list.current_page,rowsPerPage:y.list.per_page,rowsNumber:y.list.total}),p=_([]),P=_(y.search),m=ee({verifier:!1,approval:!1,planning:!1,office:!1,other:!1}),h=_([{name:"head_of_family",selected:!0},{name:"mobile",selected:!0},{name:"district",selected:!0},{name:"constituency",selected:!0},{name:"department",selected:!0},{name:"trade",selected:!0},{name:"current_status",selected:!0},{name:"action",selected:!0}]),t=ee({district:((ne=y.filter)==null?void 0:ne.district)||null,constituency:((oe=y.filter)==null?void 0:oe.constituency)||null,department:((se=y.filter)==null?void 0:se.department)||null,trade:((ie=y.filter)==null?void 0:ie.trade)||null}),d=ee({trades:[],constituencies:[]}),q=ae(n=>h.value.filter(e=>e.selected).map(e=>e.name)),w=ae(()=>!!t.department||!!t.constituency||!!t.trade||!!t.district),j=n=>{i.dialog({title:"Confirmation",message:"Do you want to send back",ok:"Yes",cancel:"No"}).onOk(()=>{const e=p.value.map(a=>a.id);V.post(route("application.bulk-send-back"),{ids:e},{preserveState:!1,onStart:a=>i.loading.show(),onFinish:a=>i.loading.hide()})})},L=n=>{i.dialog({title:"Confirmation",message:"Do you want to verify",ok:"Yes",cancel:"No"}).onOk(()=>{const e=p.value.map(a=>a.id);V.post(route("application.bulk-verify"),{ids:e},{onStart:a=>i.loading.show(),onFinish:a=>i.loading.hide()})})},U=n=>{i.dialog({title:"Confirmation",message:"Do you want to Approve",ok:"Yes",cancel:"No"}).onOk(()=>{const e=p.value.map(a=>a.id);V.post(route("application.bulk-approve"),{ids:e},{onStart:a=>i.loading.show(),onFinish:a=>i.loading.hide()})})},G=n=>{i.dialog({title:"Confirmation",message:"Do you want to verify",ok:"Yes",cancel:"No"}).onOk(()=>{const e=p.value.map(a=>a.id);V.post(route("application.bulk-planning-verify"),{ids:e},{onStart:a=>i.loading.show(),onFinish:a=>i.loading.hide()})})},H=n=>{i.dialog({title:"Confirmation",message:"Do you want to Approve",ok:"Yes",cancel:"No"}).onOk(()=>{const e=p.value.map(a=>a.id);V.post(route("application.bulk-planning-approve"),{ids:e},{onStart:a=>i.loading.show(),onFinish:a=>i.loading.hide()})})},M=n=>{i.dialog({title:"Confirmation",message:"Do you want to Approve",ok:"Yes",cancel:"No"}).onOk(()=>{const e=p.value.map(a=>a.id);V.post(route("application.bulk-executive-approve"),{ids:e},{onStart:a=>i.loading.show(),onFinish:a=>i.loading.hide()})})},Q=n=>{i.dialog({title:"Confirmation",message:"Do you want to Approve",ok:"Yes",cancel:"No"}).onOk(()=>{const e=p.value.map(a=>a.id);V.post(route("application.bulk-board-approve"),{ids:e},{onStart:a=>i.loading.show(),onFinish:a=>i.loading.hide()})})},z=n=>{switch(n){case"district":t.district=null;break;case"constituency":t.constituency=null;break;case"department":t.department=null;break;case"trade":t.trade=null;break}N({pagination:c})},fe=n=>{var a;const e=(a=qe().props)==null?void 0:a.roles;e.find(u=>u==="dc")?m.verifier=!0:e.find(u=>u==="dc-verifier")?m.approval=!0:e.find(u=>u==="dc-approval")?m.planning=!0:e.find(u=>u==="department")?m.office=!0:e.find(u=>u==="planning")&&(m.other=!0),D.value=!0},ge=n=>{N({pagination:c})},ve=(n,e,a)=>V.get(route("application.show",e.id)),be=n=>{N({pagination:c})},ye=n=>{t.district=null,t.trade=null,t.constituency=null,t.department=null,N({pagination:c})},ke=n=>{n&&(t.constituency=null,i.loading.show(),axios.get(route("option.district.constituencies",n.value)).then(e=>{const{list:a}=e.data;d.constituencies=a}).catch(e=>{var a,u;i.notify({type:"negative",message:((u=(a=e==null?void 0:e.response)==null?void 0:a.data)==null?void 0:u.message)||e.toString()})}).finally(()=>i.loading.hide()))},_e=n=>{n&&(t.trade=null,i.loading.show(),axios.get(route("option.department.trades",n.value)).then(e=>{const{list:a}=e.data;d.trades=a}).catch(e=>{var a,u;i.notify({type:"negative",message:((u=(a=e==null?void 0:e.response)==null?void 0:a.data)==null?void 0:u.message)||e.toString()})}).finally(()=>i.loading.hide()))};function N(n){var u,R,O,s;const{page:e,rowsPerPage:a}=n.pagination;V.get(route("application.received"),{per_page:a,page:e,filter_district_id:(u=t==null?void 0:t.district)==null?void 0:u.value,filter_constituency_id:(R=t==null?void 0:t.constituency)==null?void 0:R.value,filter_trade_id:(O=t==null?void 0:t.trade)==null?void 0:O.value,filter_department_id:(s=t==null?void 0:t.department)==null?void 0:s.value,search:P.value},{preserveState:!1,onStart:F=>B.value=!0,onFinish:F=>B.value=!1})}return(n,e)=>{var a,u,R,O;return f(),K(ue,null,[r("div",Le,[r("div",null,[Ge,l(he,null,{default:o(()=>[l(de,{href:n.route("dashboard"),icon:"o_dashboard",label:"Dashboard"},null,8,["href"]),l(de,{class:"text-color",label:"Inbox"})]),_:1})]),r("div",null,[l(te,{color:"accent",disable:p.value.length<=0,onClick:fe,split:"",label:"Forward","no-caps":""},{default:o(()=>[l(le,null,{default:o(()=>[l(x,{clickable:"",onClick:j},{default:o(()=>[l(C,null,{default:o(()=>[l(A,null,{default:o(()=>[S("Send Back")]),_:1})]),_:1})]),_:1}),g.canVerify?(f(),v(x,{key:0,clickable:"",onClick:L},{default:o(()=>[l(C,null,{default:o(()=>[l(A,null,{default:o(()=>[S("Verify")]),_:1})]),_:1})]),_:1})):b("",!0),g.canApprove?(f(),v(x,{key:1,clickable:"",onClick:U},{default:o(()=>[l(C,null,{default:o(()=>[l(A,null,{default:o(()=>[S("Approve")]),_:1})]),_:1})]),_:1})):b("",!0),g.canPlanningVerify?(f(),v(x,{key:2,clickable:"",onClick:G},{default:o(()=>[l(C,null,{default:o(()=>[l(A,null,{default:o(()=>[S("Verify(Planning)")]),_:1})]),_:1})]),_:1})):b("",!0),g.canPlanningApprove?(f(),v(x,{key:3,clickable:"",onClick:H},{default:o(()=>[l(C,null,{default:o(()=>[l(A,null,{default:o(()=>[S("Approve(Planning)")]),_:1})]),_:1})]),_:1})):b("",!0),g.canExecutiveApprove?(f(),v(x,{key:4,clickable:"",onClick:M},{default:o(()=>[l(C,null,{default:o(()=>[l(A,null,{default:o(()=>[S("Approve(Executive)")]),_:1})]),_:1})]),_:1})):b("",!0),g.canBoardApprove?(f(),v(x,{key:5,clickable:"",onClick:Q},{default:o(()=>[l(C,null,{default:o(()=>[l(A,null,{default:o(()=>[S("Approve(Governing Board)")]),_:1})]),_:1})]),_:1})):b("",!0)]),_:1})]),_:1},8,["disable"]),l(te,{class:"q-pa-xs","dropdown-icon":"more_vert",flat:""},{default:o(()=>[l(le,null,{default:o(()=>[l(x,null,{default:o(()=>[l(C,null,{default:o(()=>[S("Visible Column")]),_:1})]),_:1}),l(x,null,{default:o(()=>[l(C,null,{default:o(()=>[(f(!0),K(ue,null,Se(h.value,s=>(f(),v(Fe,{modelValue:s.selected,"onUpdate:modelValue":F=>s.selected=F,label:s.name,val:""},null,8,["modelValue","onUpdate:modelValue","label"]))),256))]),_:1})]),_:1})]),_:1})]),_:1})])]),He,r("div",Me,[r("div",null,[l(pe,{modelValue:P.value,"onUpdate:modelValue":[e[0]||(e[0]=s=>P.value=s),ge],autofocus:"",debounce:800,dense:"",outlined:"",placeholder:"Type here..."},null,8,["modelValue"])]),r("div",ze,[r("a",{href:n.route("export.received-application"),class:"q-btn q-btn-item non-selectable no-outline q-btn--outline q-btn--rectangle q-btn--actionable q-focusable q-hoverable"},"Export To Excel",8,Je),l(te,{"dropdown-icon":"sort",flat:""},{default:o(()=>[l(le,{class:"q-pa-md",style:{"min-width":"250px"}},{default:o(()=>[We,l(me,{onSubmit:be},{default:o(()=>[l(T,{modelValue:t.district,"onUpdate:modelValue":[e[1]||(e[1]=s=>t.district=s),ke],options:g.districts,label:"District"},null,8,["modelValue","options"]),l(T,{modelValue:t.constituency,"onUpdate:modelValue":e[2]||(e[2]=s=>t.constituency=s),options:d.constituencies,label:"Constituency"},null,8,["modelValue","options"]),l(T,{modelValue:t.department,"onUpdate:modelValue":[e[3]||(e[3]=s=>t.department=s),_e],options:g.departments,label:"Department"},null,8,["modelValue","options"]),l(T,{modelValue:t.trade,"onUpdate:modelValue":e[4]||(e[4]=s=>t.trade=s),options:d==null?void 0:d.trades,label:"Trade"},null,8,["modelValue","options"]),r("div",Ke,[l($,{type:"submit",color:"primary",label:"Apply"}),J(l($,{color:"negative",label:"Clear",outline:"",onClick:ye},null,512),[[W]])])]),_:1})]),_:1})]),_:1})])]),k(w)?(f(),K("div",Xe,[Ze,t.district!=null?(f(),v(I,{key:0,label:(a=t.district)==null?void 0:a.label,removable:"",onRemove:e[5]||(e[5]=s=>z("district"))},null,8,["label"])):b("",!0),t.constituency!=null?(f(),v(I,{key:1,label:(u=t.constituency)==null?void 0:u.label,removable:"",onRemove:e[6]||(e[6]=s=>z("constituency"))},null,8,["label"])):b("",!0),t.department!=null?(f(),v(I,{key:2,label:(R=t.department)==null?void 0:R.label,removable:"",onRemove:e[7]||(e[7]=s=>z("department"))},null,8,["label"])):b("",!0),t.trade!=null?(f(),v(I,{key:3,label:(O=t.trade)==null?void 0:O.label,removable:"",onRemove:e[8]||(e[8]=s=>z("trade"))},null,8,["label"])):b("",!0)])):b("",!0),et,l(Ae,{pagination:c.value,"onUpdate:pagination":e[9]||(e[9]=s=>c.value=s),selected:p.value,"onUpdate:selected":e[10]||(e[10]=s=>p.value=s),columns:X,filter:g.filter,loading:B.value,rows:Y.value,"rows-per-page-options":[7,15,30,50,100,200],"visible-columns":k(q),flat:"","row-key":"id",selection:"multiple","table-class":"text-color","table-header-class":"table-header",onRequest:N,onRowClick:ve},{"body-cell-action":o(s=>[r("td",tt,[r("div",lt,[l($,{onClick:Qe(F=>n.$inertia.get(n.route("application.edit",s.row.id)),["stop"]),size:"sm",icon:"edit",outline:""},null,8,["onClick"])])])]),"body-cell-current_status":o(s=>{var F,re;return[r("td",at,[r("div",nt,[l(I,{dark:"",square:"",label:(re=(F=s.row)==null?void 0:F.current_status)==null?void 0:re.name},null,8,["label"])])])]}),_:1},8,["pagination","selected","filter","loading","rows","visible-columns"]),l(E,{modelValue:m.other,"onUpdate:modelValue":e[11]||(e[11]=s=>m.other=s)},{default:o(()=>[l(je,{files:p.value},null,8,["files"])]),_:1},8,["modelValue"]),l(E,{modelValue:m.verifier,"onUpdate:modelValue":e[12]||(e[12]=s=>m.verifier=s)},{default:o(()=>[l(Ue,{files:p.value},null,8,["files"])]),_:1},8,["modelValue"]),l(E,{modelValue:m.approval,"onUpdate:modelValue":e[13]||(e[13]=s=>m.approval=s)},{default:o(()=>[l($e,{files:p.value},null,8,["files"])]),_:1},8,["modelValue"]),l(E,{modelValue:m.planning,"onUpdate:modelValue":e[14]||(e[14]=s=>m.planning=s)},{default:o(()=>[l(Be,{files:p.value},null,8,["files"])]),_:1},8,["modelValue"]),l(E,{modelValue:m.office,"onUpdate:modelValue":e[15]||(e[15]=s=>m.office=s)},{default:o(()=>[l(De,{files:p.value},null,8,["files"])]),_:1},8,["modelValue"])],64)}}};export{ft as default};
