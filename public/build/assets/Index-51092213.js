import{Q as ie,a as j}from"./QBreadcrumbs-f1fcde01.js";import{a1 as re,h as b,r as D,T as w,au as de,E as ue,o as p,e as S,a as i,d as o,w as u,av as A,m as ce,u as q,c as y,f as v,F as G,aw as H,p as J,s as O,x as X,k as me,n as pe,Q as E,b as fe,ax as ge,C as be}from"./app-a7abb58d.js";import{Q as V}from"./QSelect-57ce204b.js";import{Q as ye}from"./QForm-ea84dcf4.js";import{Q as F}from"./QChip-85d4182d.js";import{Q as ve}from"./QTable-33cc80a5.js";import"./rtl-36dd996b.js";import"./use-fullscreen-7c8ce305.js";const _e={class:"flex justify-between items-center"},he=i("p",{class:"page-header"},"List of Application",-1),xe=i("br",null,null,-1),we={class:"flex justify-between items-center"},Ve={class:"flex q-gutter-sm"},Qe=i("p",{class:"text-color text-lg q-my-sm"},"Filter",-1),ke={class:"flex q-gutter-sm q-mt-md"},Ce={key:0,class:"flex items-baseline q-gutter-sm q-mt-md"},De=i("p",{class:"text-bold text-primary"},"Filter :",-1),Se=i("br",null,null,-1),Te={__name:"Index",props:["departments","districts","constituencies","district"],setup(Q){var P,R,T;const c=Q,z=[{name:"sn",align:"left",label:"SN",field:"id"},{name:"head_of_family",align:"left",label:"Head of Family",field:"head_of_family"},{name:"mobile",align:"left",label:"Mobile",field:"mobile"},{name:"epic_no",align:"left",label:"Epic no",field:"epic_no"},{name:"district",align:"left",label:"District",field:"district",format:t=>t==null?void 0:t.name},{name:"constituency",align:"left",label:"Constituency",field:"constituency",format:t=>t==null?void 0:t.name},{name:"department",align:"left",label:"Department",field:"department",format:t=>t==null?void 0:t.name},{name:"trade",align:"left",label:"Trade",field:"trade",format:t=>t==null?void 0:t.name},{name:"first_movement",align:"center",label:"Entry",field:"first_movement",format:t=>{var e;return(e=t==null?void 0:t.recipient)==null?void 0:e.name}},{name:"last_movement",align:"center",label:"Current Location",field:"last_movement",format:t=>{var e;return(e=t==null?void 0:t.recipient)==null?void 0:e.name}}],r=re(),K=b(!1),d=b({page:1,rowsPerPage:15,rowsNumber:0}),_=D({per_page:3,data:[],current_page:1,total:1}),B=b([]),k=b(c.search),U=b([{name:"head_of_family",selected:!0},{name:"mobile",selected:!0},{name:"district",selected:!0},{name:"constituency",selected:!0},{name:"department",selected:!0},{name:"trade",selected:!0},{name:"first_movement",selected:!0},{name:"last_movement",selected:!0},{name:"action",selected:!0}]);w(()=>Math.ceil(_.total/_.per_page));const W=w(()=>{const t=de().props.roles;if(t){const e=t[0];return e==="planning"||e==="admin"||e==="governing"||e==="dc-approval"||e==="dc-verifier"}return!1}),l=D({district:(c==null?void 0:c.district)||null,constituency:((P=c.filter)==null?void 0:P.constituency)||null,department:((R=c.filter)==null?void 0:R.department)||null,trade:((T=c.filter)==null?void 0:T.trade)||null}),f=D({trades:[],constituencies:[]}),Y=w(t=>U.value.filter(e=>e.selected).map(e=>e.name)),Z=w(()=>!!l.department||!!l.constituency||!!l.trade||!!l.district);ue(()=>{l.district=c.districts[0]||null,N(l.district),g({pagination:d.value})});const C=t=>{switch(t){case"district":l.district=null;break;case"constituency":l.constituency=null;break;case"department":l.department=null;break;case"trade":l.trade=null;break}g({pagination:d})},ee=t=>g({pagination:d.value}),te=(t,e,n)=>H.get(route("application.show",e.id)),le=t=>g({pagination:d.value}),ae=t=>{l.district=null,l.trade=null,l.constituency=null,l.department=null,g({pagination:d})},N=t=>{t&&(l.constituency=null,r.loading.show(),axios.get(route("option.district.constituencies",t.value)).then(e=>{const{list:n}=e.data;f.constituencies=n}).catch(e=>{var n,s;r.notify({type:"negative",message:((s=(n=e==null?void 0:e.response)==null?void 0:n.data)==null?void 0:s.message)||e.toString()})}).finally(()=>r.loading.hide()))},ne=t=>{t&&(l.trade=null,r.loading.show(),axios.get(route("option.department.trades",t.value)).then(e=>{const{list:n}=e.data;f.trades=n}).catch(e=>{var n,s;r.notify({type:"negative",message:((s=(n=e==null?void 0:e.response)==null?void 0:n.data)==null?void 0:s.message)||e.toString()})}).finally(()=>r.loading.hide()))},oe=t=>{var e,n,s,m;H.get(route("export.district-application",{district_id:((e=l.district)==null?void 0:e.value)||null,constituency_id:((n=l.constituency)==null?void 0:n.value)||null,trade_id:((s=l.trade)==null?void 0:s.value)||null,department_id:((m=l.department)==null?void 0:m.value)||null}),{},{onStart:a=>r.loading.show({message:"Generating..."}),onFinish:a=>r.loading.hide(),preserveState:!1})},g=t=>{var a,h,I,L;const{page:e,rowsPerPage:n,sortBy:s,descending:m}=t.pagination;r.loading.show(),axios.get(route("application.district.all"),{params:{page:e,rowsPerPage:n,sortBy:s,descending:m,search:k.value,district_id:((a=l.district)==null?void 0:a.value)||null,constituency_id:((h=l.constituency)==null?void 0:h.value)||null,trade_id:((I=l.trade)==null?void 0:I.value)||null,department_id:((L=l.department)==null?void 0:L.value)||null}}).then(x=>se(x.data.list)).catch(x=>{var M,$;return r.notify({type:"negative",message:(($=(M=x.response)==null?void 0:M.data)==null?void 0:$.message)||x.toString()})}).finally(()=>r.loading.hide())},se=t=>{const{current_page:e,per_page:n,data:s,to:m,total:a}=t;_.data=s,d.value.rowsNumber=a,d.value.page=e,d.value.rowsPerPage=n};return(t,e)=>{var n,s,m;return p(),S(G,null,[i("div",_e,[i("div",null,[he,o(ie,null,{default:u(()=>[o(j,{href:t.route("dashboard"),icon:"o_dashboard",label:"Dashboard"},null,8,["href"]),o(j,{class:"text-color",label:"Inbox"})]),_:1})]),i("div",null,[o(A,{class:"q-pa-xs","dropdown-icon":"more_vert",flat:""},{default:u(()=>[o(J,null,{default:u(()=>[o(O,null,{default:u(()=>[o(X,null,{default:u(()=>[me("Visible Column")]),_:1})]),_:1}),o(O,null,{default:u(()=>[o(X,null,{default:u(()=>[(p(!0),S(G,null,pe(U.value,a=>(p(),y(ge,{modelValue:a.selected,"onUpdate:modelValue":h=>a.selected=h,label:a.name,val:""},null,8,["modelValue","onUpdate:modelValue","label"]))),256))]),_:1})]),_:1})]),_:1})]),_:1})])]),xe,i("div",we,[i("div",null,[o(ce,{modelValue:k.value,"onUpdate:modelValue":[e[0]||(e[0]=a=>k.value=a),ee],autofocus:"",debounce:800,dense:"",outlined:"",placeholder:"Type here..."},null,8,["modelValue"])]),i("div",Ve,[q(W)?(p(),y(E,{key:0,color:"accent",onClick:oe,label:"Export EXCEL"})):v("",!0),o(A,{"dropdown-icon":"sort",flat:""},{default:u(()=>[o(J,{class:"q-pa-md",style:{"min-width":"250px"}},{default:u(()=>[Qe,o(ye,{onSubmit:le},{default:u(()=>[o(V,{modelValue:l.district,"onUpdate:modelValue":[e[1]||(e[1]=a=>l.district=a),N],options:Q.districts,label:"District"},null,8,["modelValue","options"]),o(V,{modelValue:l.constituency,"onUpdate:modelValue":e[2]||(e[2]=a=>l.constituency=a),options:f.constituencies,label:"Constituency"},null,8,["modelValue","options"]),o(V,{modelValue:l.department,"onUpdate:modelValue":[e[3]||(e[3]=a=>l.department=a),ne],options:Q.departments,label:"Department"},null,8,["modelValue","options"]),o(V,{modelValue:l.trade,"onUpdate:modelValue":e[4]||(e[4]=a=>l.trade=a),options:f==null?void 0:f.trades,label:"Trade"},null,8,["modelValue","options"]),i("div",ke,[o(E,{type:"submit",color:"primary",label:"Apply"}),fe(o(E,{color:"negative",label:"Clear",outline:"",onClick:ae},null,512),[[be]])])]),_:1})]),_:1})]),_:1})])]),q(Z)?(p(),S("div",Ce,[De,l.constituency!=null?(p(),y(F,{key:0,label:(n=l.constituency)==null?void 0:n.label,removable:"",onRemove:e[5]||(e[5]=a=>C("constituency"))},null,8,["label"])):v("",!0),l.department!=null?(p(),y(F,{key:1,label:(s=l.department)==null?void 0:s.label,removable:"",onRemove:e[6]||(e[6]=a=>C("department"))},null,8,["label"])):v("",!0),l.trade!=null?(p(),y(F,{key:2,label:(m=l.trade)==null?void 0:m.label,removable:"",onRemove:e[7]||(e[7]=a=>C("trade"))},null,8,["label"])):v("",!0)])):v("",!0),Se,o(ve,{pagination:d.value,"onUpdate:pagination":e[8]||(e[8]=a=>d.value=a),selected:B.value,"onUpdate:selected":e[9]||(e[9]=a=>B.value=a),columns:z,filter:t.filter,loading:K.value,rows:_.data,"rows-per-page-options":[7,15,30,50,100,200],"visible-columns":q(Y),flat:"","row-key":"id",selection:"multiple","table-class":"text-color","table-header-class":"table-header",onRequest:g,onRowClick:te},null,8,["pagination","selected","filter","loading","rows","visible-columns"])],64)}}};export{Te as default};
